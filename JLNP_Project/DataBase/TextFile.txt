Create Proc Proc_GetTeacher
@Mobile varchar(12) = '',
@Fromdate varchar(20) = '',
@Todate varchar(20) = ''
AS
BEGIN
	select * from tbl_Teacher where Mobile = IIF(@Mobile = '',Mobile,@Mobile)
	and EntryDate >= IIF(@Fromdate = '',EntryDate,@Fromdate) and EntryDate <= IIF(@Todate = '',EntryDate,@Todate)
END





=====================================================



USE [DB_CollageManagement]
GO
/****** Object:  StoredProcedure [dbo].[Proc_Teacher]    Script Date: 9/12/2023 11:02:22 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER Proc [dbo].[Proc_Teacher]        
@TeacherId int=0,        
@name varchar(100)=null,        
@Fname varchar(100)=null,        
@Email varchar(100)=null,        
@Mobile varchar(100)=null,
@DOB varchar(100)=null,        
@Address varchar(100)=null,        
@salary varchar(100)=null,          
@Action varchar(100)=null,      
@HighSchoolMarks numeric(10,2)=null,      
@HighSchool_P numeric(10,2)=null,      
@HighSchool_B varchar(50)=null,      
@InterMarks numeric(10,2)=null,      
@Inter_P int=null,      
@Inter_B varchar(50)=null,      
@UGTitle varchar(50)=null,      
@UGMarks numeric(10,2)=null,      
@UG_Collage varchar(50)=null,      
@PGTitle varchar(50)=null,      
@PGMarks numeric(10,2)=null,      
@PG_Collage varchar(50)=null,      
@PreviousCollage varchar(50)=null,      
@Subjects varchar(50)=null,      
@Experiance int=null,
@Gender varchar(1) = ''
as        
BEGIN        
declare @UserId int,@Password nvarchar(50)           
if(@Action = 'Add')        
Begin      
 if(@TeacherId = 0)    
 begin    
  if Exists(Select 1 from tbl_Teacher where Mobile = @Mobile)        
  begin        
   select -1 StatusCode,'Teacher already exists!' Msg
   return        
  end
  insert into tbl_Users([Name],Fname,Email,Mobile,[Address],Gender,DOB,MotherName,Religion,RoleId,IsActive,ReffId)
  values(@name,@Fname,@Email,@Mobile,@Address,@Gender,@DOB,'','',2,1,0);
  set @UserId = SCOPE_IDENTITY();

  insert into tbl_Teacher(Name,Fname,Email,Mobile,Address,salary,DOB,Entrydate,HighSchoolMarks,HighSchool_P,      
  HighSchool_B,InterMarks,Inter_P,Inter_B,UGTitle,UGMarks,UG_Collage,PGTitle,PGMarks,PG_Collage,PreviousCollage,Subjects,Experiance,UserId)      
  values(@Name,@Fname,@Email,@Mobile,@Address,@salary,@DOB,GETDATE(),@HighSchoolMarks,@HighSchool_P,@HighSchool_B,      
  @InterMarks,@Inter_P,@Inter_B,@UGTitle,@UGMarks,@UG_Collage,@PGTitle,@PGMarks,@PG_Collage,@PreviousCollage,@Subjects,@Experiance,@UserId)
  SELECT @Password = (Cast((select TeacherId from tbl_Teacher Where Mobile = @Mobile) as varchar)+CAST(ROUND(RAND()*1000000, 0) AS VARCHAR))
  insert into tbl_login(UserId,UserName,[Password]) values(@UserId,@Mobile,@Password);
  select 1 StatusCode,'Teacher Add Successfully!' Msg    
 end      
 else    
 begin    
  update tbl_Teacher set Name=@Name,Fname=@Fname,Email=@Email,Mobile=@Mobile,Address=@Address,salary=@salary,DOB=@DOB,ModifyDate=getdate() where TeacherId = @TeacherId        
  SELECT 1 StatusCode,'Teacher Edit Successfully!' Msg    
 end    
end       
if(@Action = 'GetById')        
 begin        
  select tt.*,tl.Password from tbl_Teacher tt  
  INNER JOIN tbl_login tl on tt.TeacherId = tl.UserId where tt.TeacherId = @TeacherId        
 end           
if(@Action = 'Delete')        
 begin        
  delete from tbl_Teacher where TeacherId = @TeacherId        
  delete from tbl_login where UserId = @TeacherId and ID <> 1    
  select 1 StatusCode,'Teacher Delete Successfully!' Msg        
 end        
END 


=============================================================

alter table tbl_teacher drop column RoleId

alter table tbl_teacher Add UserId int